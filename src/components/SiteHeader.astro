---
// src/components/SiteHeader.astro
---

<header
  class="animate-in-fade sticky top-0 z-50"
  style="
    animation-delay: 0s;
    border-bottom: 1px solid var(--color-border);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
  "
>
  <div
    style="max-width: var(--container-max)"
    class="mx-auto px-6 py-4 flex items-center justify-between"
  >
    <p class="header-title">
      <span
        id="header-scramble"
        data-final="artoshi"
      >artoshi</span>
    </p>
    <p class="header-sub">design · engineering</p>
  </div>
</header>

<style>
  .header-title {
    font-family: var(--font-mono);
    font-size: 0.75rem;
    font-weight: 500;
    color: var(--color-primary);
    letter-spacing: 0.05em;
    text-transform: uppercase;
  }

  .header-sub {
    font-family: var(--font-mono);
    font-size: 0.75rem;
    color: var(--color-secondary);
    letter-spacing: 0.05em;
    text-transform: uppercase;
  }
</style>

<script>
  const POOL = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789·_-';
  const TICK_MS = 40;

  function scramble(el: HTMLElement) {
    const final = el.dataset.final ?? el.textContent ?? '';
    let resolved = 0;

    const interval = setInterval(() => {
      const chars = final.split('').map((ch, i) => {
        if (i < resolved) return ch;
        return POOL[Math.floor(Math.random() * POOL.length)];
      });
      el.textContent = chars.join('');

      resolved++;
      if (resolved >= final.length) {
        el.textContent = final;
        clearInterval(interval);
      }
    }, TICK_MS);
  }

  const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

  if (!prefersReduced) {
    const el = document.getElementById('header-scramble') as HTMLElement | null;
    if (el) scramble(el);
  }
</script>
