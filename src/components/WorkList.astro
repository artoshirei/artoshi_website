---
// src/components/WorkList.astro
import type { WorkItem } from "../data/work";

interface Props {
  items: WorkItem[];
}
const { items } = Astro.props;

// Sort descending by year
const sorted = [...items].sort((a, b) => b.year - a.year);

// Spread animation delays from 0.15s to 0.75s
const delay = (i: number) => {
  const min = 0.15, max = 0.75;
  return (min + (max - min) * (i / Math.max(sorted.length - 1, 1))).toFixed(2);
};
---

<main style="max-width: var(--container-max)" class="flex-1 mx-auto px-6 pb-32 w-full">
  <ul class="work-list">
    {sorted.map((item, i) => (
      <li
        class="work-item animate-in"
        style={`animation-delay: ${delay(i)}s; border-top: 1px solid var(--color-border)`}
      >
        {item.url ? (
          <a href={item.url} class="work-link" target="_blank" rel="noopener noreferrer">
            <span class="work-year">{item.year}</span>
            <div class="work-body">
              <span class="work-title">
                {item.title}
                {item.current && <span class="work-now">now</span>}
              </span>
              <p class="work-desc">{item.description}</p>
            </div>
            <span class="work-arrow" aria-hidden="true">↗</span>
          </a>
        ) : (
          <div class="work-link">
            <span class="work-year">{item.year}</span>
            <div class="work-body">
              <span class="work-title">
                {item.title}
                {item.current && <span class="work-now">now</span>}
              </span>
              <p class="work-desc">{item.description}</p>
            </div>
          </div>
        )}
      </li>
    ))}
  </ul>
</main>

<style>
  .work-list {
    list-style: none;
    margin: 0;
    padding: 0;
  }

  .work-item {
    transition: opacity 0.2s ease;
  }

  /* Dim all items when any item is hovered — CSS-only using :has() */
  .work-list:has(.work-item:hover) .work-item {
    opacity: 0.35;
  }
  .work-list:has(.work-item:hover) .work-item:hover {
    opacity: 1;
  }

  .work-link {
    display: flex;
    align-items: baseline;
    gap: 1.5rem;
    padding: 1rem 0;
    text-decoration: none;
    color: inherit;
  }

  .work-year {
    font-family: var(--font-mono);
    font-size: 0.75rem;
    color: var(--color-tertiary);
    width: 2.5rem;
    flex-shrink: 0;
    font-variant-numeric: tabular-nums;
  }

  .work-body {
    flex: 1;
    min-width: 0;
  }

  .work-title {
    font-size: 0.875rem;
    color: var(--color-primary);
    font-weight: 500;
    display: block;
  }

  .work-now {
    font-family: var(--font-mono);
    font-size: 0.7rem;
    color: var(--color-tertiary);
    margin-left: 0.5rem;
    vertical-align: middle;
  }

  .work-desc {
    font-size: 0.875rem;
    color: var(--color-secondary);
    margin: 0.2rem 0 0;
    line-height: 1.5;
  }

  .work-arrow {
    font-size: 0.75rem;
    color: var(--color-tertiary);
    flex-shrink: 0;
    opacity: 0;
    transition: opacity 0.15s ease;
    margin-left: auto;
  }

  .work-item:hover .work-arrow {
    opacity: 1;
  }
</style>
