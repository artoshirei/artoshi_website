---
// src/components/WorkList.astro
import type { WorkItem } from "../data/work";

interface Props {
  items: WorkItem[];
}
const { items } = Astro.props;

// Sort descending by year
const sorted = [...items].sort((a, b) => b.year - a.year);

// Faster reverse stagger: top item 0.3s, bottom item ~0.14s (40ms steps)
const delay = (i: number) =>
  (0.3 - (i / sorted.length) * 0.2).toFixed(3);

// Internal links start with / ; external start with http
const isExternal = (url: string) => url.startsWith("http");
---

<ul class="work-list">
  {sorted.map((item, i) => (
    <li
      class="work-item animate-in"
      style={`animation-delay: ${delay(i)}s`}
    >
      {item.url ? (
        <a
          href={item.url}
          class="work-row"
          target={isExternal(item.url) ? "_blank" : "_self"}
          rel={isExternal(item.url) ? "noopener noreferrer" : undefined}
        >
          <span class="work-year">{item.year}</span>
          <span class="work-title">
            {item.title}
            {item.current && <span class="work-now">now</span>}
          </span>
          <span class="work-tag">{item.categories[0]}</span>
          <span class="work-arrow" aria-hidden="true">
            {isExternal(item.url) ? (
              /* Arrow — external link (IBM Carbon arrow-up-right) */
              <svg focusable="false" fill="currentColor" width="10" height="10" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
                <path d="M10 6L10 8 22.59 8 6 24.59 7.41 26 24 9.41 24 22 26 22 26 6 10 6z" />
              </svg>
            ) : (
              /* Dot — internal link (IBM Carbon circle) */
              <svg focusable="false" fill="currentColor" width="10" height="10" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
                <circle cx="16" cy="16" r="8" />
              </svg>
            )}
          </span>
        </a>
      ) : (
        <div class="work-row">
          <span class="work-year">{item.year}</span>
          <span class="work-title">
            {item.title}
            {item.current && <span class="work-now">now</span>}
          </span>
          <span class="work-tag">{item.categories[0]}</span>
        </div>
      )}
    </li>
  ))}
</ul>

<style>
  .work-list {
    list-style: none;
    margin: 0;
    padding: 0;
  }

  /* ─── Hover: dim siblings, keep hovered item bright ─── */
  .work-item {
    border-top: 1px solid var(--color-border);
    /* slow fade OUT (siblings dimming) */
    transition: opacity 1000ms cubic-bezier(0.4, 0, 0.2, 1),
                background-color 1000ms cubic-bezier(0.4, 0, 0.2, 1);
  }

  /* When ANY sibling row is hovered, dim non-hovered items */
  .work-list:has(.work-row:hover) .work-item:not(:has(.work-row:hover)) {
    opacity: 0.4;
  }

  /* Hovered item: instant snap to full + subtle bg */
  .work-item:has(.work-row:hover) {
    opacity: 1 !important;
    background-color: rgb(23 23 23); /* neutral-900 */
    transition-duration: 0ms;
  }

  /* ─── Row layout ─────────────────────────────────────── */
  .work-row {
    display: flex;
    align-items: baseline;
    gap: 1.25rem;
    padding: 0.75rem 0;
    text-decoration: none;
    color: inherit;
    cursor: default;
  }

  a.work-row {
    cursor: pointer;
  }

  /* Year: small, monospace, fixed width */
  .work-year {
    font-family: var(--font-mono);
    font-size: 0.75rem;
    color: var(--color-tertiary);
    flex-shrink: 0;
    width: 2.75rem;
    font-variant-numeric: tabular-nums;
  }

  /* Title: takes all remaining space */
  .work-title {
    font-size: 0.875rem;
    color: var(--color-primary);
    font-weight: 400;
    flex: 1;
    min-width: 0;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  /* "now" badge inline after title */
  .work-now {
    font-family: var(--font-mono);
    font-size: 0.65rem;
    color: var(--color-tertiary);
    margin-left: 0.5rem;
    vertical-align: middle;
    letter-spacing: 0.05em;
  }

  /* Category tag: right side, dim */
  .work-tag {
    font-family: var(--font-mono);
    font-size: 0.7rem;
    color: var(--color-tertiary);
    flex-shrink: 0;
    letter-spacing: 0.04em;
  }

  /* Indicator (dot or arrow): hidden + blurred at rest, reveals on hover */
  .work-arrow {
    flex-shrink: 0;
    align-self: center;
    color: var(--color-secondary);
    /* rest state */
    opacity: 0;
    width: 0;
    margin-left: 0;
    overflow: hidden;
    filter: blur(2px);
    /* EXIT transition (slow — asymmetric) */
    transition: opacity 250ms cubic-bezier(0, 0, 0.58, 1),
                width 1s cubic-bezier(0, 0, 0.58, 1),
                margin-left 1s cubic-bezier(0, 0, 0.58, 1),
                filter 250ms cubic-bezier(0, 0, 0.58, 1);
  }

  /* ENTER: fast override when parent row is hovered */
  .work-row:hover .work-arrow {
    opacity: 1;
    width: 10px;
    margin-left: 6px;
    filter: blur(0);
    transition-duration: 150ms;
  }

  @media (prefers-reduced-motion: reduce) {
    .work-item,
    .work-arrow {
      transition: none;
    }
  }
</style>
