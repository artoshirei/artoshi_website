---
// src/components/WorkList.astro
import type { WorkItem } from "../data/work";

interface Props {
  items: WorkItem[];
}
const { items } = Astro.props;

// Sort descending by year
const sorted = [...items].sort((a, b) => b.year - a.year);

// Reverse stagger: top item delays longest (1.0s), bottom item shortest
// Formula matches baytas.net: delay = 1.0 - (i / total)
const delay = (i: number) =>
  (1.0 - i / sorted.length).toFixed(3);
---

<ul class="work-list">
  {sorted.map((item, i) => (
    <li
      class="work-item animate-in"
      style={`animation-delay: ${delay(i)}s`}
    >
      {item.url ? (
        <a href={item.url} class="work-row" target="_blank" rel="noopener noreferrer">
          <span class="work-year">{item.year}</span>
          <span class="work-title">
            {item.title}
            {item.current && <span class="work-now">now</span>}
          </span>
          <span class="work-tag">{item.categories[0]}</span>
          <span class="work-arrow" aria-hidden="true">↗</span>
        </a>
      ) : (
        <div class="work-row">
          <span class="work-year">{item.year}</span>
          <span class="work-title">
            {item.title}
            {item.current && <span class="work-now">now</span>}
          </span>
          <span class="work-tag">{item.categories[0]}</span>
        </div>
      )}
    </li>
  ))}
</ul>

<style>
  .work-list {
    list-style: none;
    margin: 0;
    padding: 0;
  }

  /* ─── Hover: dim siblings, keep hovered item bright ─── */
  .work-item {
    border-top: 1px solid var(--color-border);
    /* slow fade OUT (siblings dimming) */
    transition: opacity 1000ms cubic-bezier(0.4, 0, 0.2, 1),
                background-color 1000ms cubic-bezier(0.4, 0, 0.2, 1);
  }

  /* When ANY sibling row is hovered, dim non-hovered items */
  .work-list:has(.work-row:hover) .work-item:not(:has(.work-row:hover)) {
    opacity: 0.4;
  }

  /* Hovered item: instant snap to full + subtle bg */
  .work-item:has(.work-row:hover) {
    opacity: 1 !important;
    background-color: rgb(23 23 23); /* neutral-900 */
    transition-duration: 0ms;
  }

  /* ─── Row layout ─────────────────────────────────────── */
  .work-row {
    display: flex;
    align-items: baseline;
    gap: 1.25rem;
    padding: 0.75rem 0;
    text-decoration: none;
    color: inherit;
    cursor: default;
  }

  a.work-row {
    cursor: pointer;
  }

  /* Year: small, monospace, fixed width */
  .work-year {
    font-family: var(--font-mono);
    font-size: 0.75rem;
    color: var(--color-tertiary);
    flex-shrink: 0;
    width: 2.75rem;
    font-variant-numeric: tabular-nums;
  }

  /* Title: takes all remaining space */
  .work-title {
    font-size: 0.875rem;
    color: var(--color-primary);
    font-weight: 400;
    flex: 1;
    min-width: 0;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  /* "now" badge inline after title */
  .work-now {
    font-family: var(--font-mono);
    font-size: 0.65rem;
    color: var(--color-tertiary);
    margin-left: 0.5rem;
    vertical-align: middle;
    letter-spacing: 0.05em;
  }

  /* Category tag: right side, dim */
  .work-tag {
    font-family: var(--font-mono);
    font-size: 0.7rem;
    color: var(--color-tertiary);
    flex-shrink: 0;
    letter-spacing: 0.04em;
  }

  /* External link arrow: visible only on link rows */
  .work-arrow {
    font-size: 0.75rem;
    color: var(--color-secondary);
    flex-shrink: 0;
    opacity: 0;
    transition: opacity 0.15s ease;
  }

  .work-item:hover .work-arrow {
    opacity: 1;
  }
</style>
